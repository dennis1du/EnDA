---
title: "DU_JIANWEI_FINAL_REPORT"
author: "Jianwei Du"
date: "5/10/2018"
output: html_document
toc: yes
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(grid)
library(jpeg)
library(png)
library(RCurl)
library(DT)
library(scales)
```

# 1 Introduction
This project was aimed at analyzing the offensive performance of NBA players with statistics. Given the huge stats dataset of NBA Official website, it is a natural idea to use technical skills, learned from class, for processing and analysis. With respect to the objective of "offensive performance", this project focused on the shooting records, although there are other related data including assists and offensive rebounds.

The main deliverable is a Shiny app file, for interactive visualization and analysis of players from NBA team Golden States Warriors during 2016-17 Regular Season. R file for data collecting and cleaning is also attached, as well as cleaned dataset files.

# 2 Data Processing
All of the data processing was conducted in R file "*DU_JIANWEI_FINAL_DATA*".

### 2.1 Data Collecting
The file named "*Player Regular 16-17 Stats.csv*" was used to extract "PLAYER_ID" data for further data collecting. Package rjson was adopted to collect shot logs from website, with player IDs. The preliminary processing was converting raw data to dataframe object.

### 2.2 Data Cleaning
Unnessary and outlier data were removed. As for the rest of data, levels or values of some of stats records were modified, and the "GAME_DATE" data were converted to object with type of Date. In the end, cleaned data was saved for analysis as "*Shotlog_GSW.csv*".

# 3 Shiny
In order to achieve interactive visualization and analysis, Shiny was selected for the major part of the projet.

### 3.1 UI
There were 2 inputs. Since the project aimed at analysis for the whole team, one of the inputs was the `selectInput()`, with `choices` covering all of the player names, for selection among different players in Warriors. Furthermore, considering the dataset contained date data, `dateRangeInput()` was also added to UI, for analysis in different periods. Note that the `start` and `end` were determined by the season schedule.

The project had several plot and table outputs. Plot ouputs included "*Shot Chart*", "*Shot Type*" and "*Shot Range*". Note that "*Player Profile*" was also introduced, for advanced development of UI. Table outputs for "*Shot Type*" and "*Shot Range*" were added, while there were also tables for "*Summary*" and "*Hit Rate*".

All the outputs were embed in different tabpanels, for advanced develompent of UI configuration.

### 3.2 Server
Given interactive environment, `reactive()` was used for data secondary processing, while `renderPlot()` and `renderDataTable()` were adopted for ouputs of plot and table.


# 4 Analysis
One player(e.g. Stephen Curry) was selected as example in this report.

- **Output 1-Player Profile**: advanced design for UI, with `readPNG()` for collecting and `ggplot()` for plot.

- **Output 2-Shot Chart Plot**: data visulization using `ggplot()`, describing shot results in different areas of the court.
```{r echo=FALSE}
dir <- getwd()
shotData <- read.csv(paste(dir,"/Shotlog_GSW.csv",sep=''))
courtImg.URL <- "https://thedatagame.files.wordpress.com/2016/03/nba_court.jpg"
court <- rasterGrob(readJPEG(getURLContent(courtImg.URL)),
                    width=unit(1,"npc"), height=unit(1,"npc"))

ggplot(shotData[shotData$PLAYER_NAME == "Stephen Curry",], aes(x=LOC_X, y=LOC_Y)) +
      annotation_custom(court, -250, 250, -50, 420) +
      geom_point(aes(colour = SHOT_ZONE_BASIC, shape = EVENT_TYPE)) +
      scale_shape_manual(values = c(16,88)) +
      xlim(250, -250) +
      ylim(-50, 420) +
      coord_fixed() +
      theme(line = element_blank(),
            axis.title.x = element_blank(),
            axis.title.y = element_blank(),
            axis.text.x = element_blank(),
            axis.text.y = element_blank(),
            legend.title = element_blank())
```

It is easy to see that this player is very good at shooting, especially for 3-pointers and scores in the restricetd aera.

- **Output 3-Summary**: descriptive stats for shot records using `summary()`.
```{r echo=FALSE}
summary(shotData[shotData$PLAYER_NAME == "Stephen Curry",][,c(4,5,6,7,8,9)])
shotData <- shotData[shotData$PLAYER_NAME == "Stephen Curry",]
```

The summary indicates the player is quite good at shooting, his favorite or best shot type is jump shot and 3-pointers, and his favorite shot areas, as well as numerical stats of his shot range and distance.

- **Output 4-Hit Rate Table**: general statistics analysis for shooting. 
```{r echo=FALSE}
FA <- sum(shotData$SHOT_ATTEMPTED_FLAG)
FM <- sum(shotData$SHOT_MADE_FLAG)
FA2 <- sum(shotData[shotData$SHOT_TYPE == "2PT","SHOT_ATTEMPTED_FLAG"])
FM2 <- sum(shotData[shotData$SHOT_TYPE == "2PT","SHOT_MADE_FLAG"])
FA3 <- FA - FA2
FM3 <- FM - FM2
PTs <- FM2*2 + FM3*3
PTA <- PTs/FA
P2A <- FM2*2/FA2
P3A <- FM3*3/FA3
FG <- FM/FA
F2 <- FM2/FA2
F3 <- FM3/FA3
dt1 <- data.frame(PTs, round(PTA,2), round(P2A,2), round(P3A,2), percent(FG), percent(F2), percent(F3))
names(dt1) <- c("PT", "PT/Attmpt", "2P/Attmpt", "3P/Attmpt", "FG%", "2P%", "3P%")
print(dt1)
```

"PT" is the total scores in that period. "PT/Attmpt", "2P/Attmpt" and "3P/Attmpt" mean the scores per general attempt, 2-pointers attempt and 3-pointers attempt, respectively. These stats show the player's ability and efficiency to shoot. "FG%", "2P%" and "3P%" are general hit rate stats. Obviously, it shows that this player is really great at shooting, with high efficiency.

- **Output 5&6-Shot Type Plot&Table**: data visualization and statistic analysis for players skills in offense. 
```{r echo=FALSE}
dt2 <- data.frame(table(shotData$ACTION_TYPE))
T1 <- sum(shotData[shotData$ACTION_TYPE == "Jump Shot","SHOT_MADE_FLAG"])/sum(shotData[shotData$ACTION_TYPE == "Jump Shot","SHOT_ATTEMPTED_FLAG"])
T2 <- sum(shotData[shotData$ACTION_TYPE == "Layup","SHOT_MADE_FLAG"])/sum(shotData[shotData$ACTION_TYPE == "Layup","SHOT_ATTEMPTED_FLAG"])
T3 <- sum(shotData[shotData$ACTION_TYPE == "Fadeaway","SHOT_MADE_FLAG"])/sum(shotData[shotData$ACTION_TYPE == "Fadeaway","SHOT_ATTEMPTED_FLAG"])
T4 <- sum(shotData[shotData$ACTION_TYPE == "Hook Shot","SHOT_MADE_FLAG"])/sum(shotData[shotData$ACTION_TYPE == "Hook Shot","SHOT_ATTEMPTED_FLAG"])
T5 <- sum(shotData[shotData$ACTION_TYPE == "Bank Shot","SHOT_MADE_FLAG"])/sum(shotData[shotData$ACTION_TYPE == "Bank Shot","SHOT_ATTEMPTED_FLAG"])
T6 <- sum(shotData[shotData$ACTION_TYPE == "Dunk","SHOT_MADE_FLAG"])/sum(shotData[shotData$ACTION_TYPE == "Dunk","SHOT_ATTEMPTED_FLAG"])
dt2$Var1 <- factor(dt2$Var1, levels=c('Jump Shot','Layup','Fadeaway','Hook Shot', 'Bank Shot', 'Dunk'))
dt2 <- cbind(dt2[c(5,6,3,4,1,2),],c(percent(T1),percent(T2),percent(T3),percent(T4), percent(T5), percent(T6)))
names(dt2) <- c("Type", "Attmpt", "FG%")
rownames(dt2) <- NULL
ggplot(data = dt2) + 
  geom_bar(aes(Type, Attmpt), stat = 'identity', width = 0.5, fill = 'yellow2')
datatable(dt2)
```

The plot in tis part shows that the jump shot is his favorite/best shooting skill, and the second one is layup. And the table also proves that point, given the large amount of attempts. In fact, apart from Hook Shot, he has kept high efficiency in offense.

- Output 7&8-Shot Range Plot&Table: data visualization and statistic analysis for players performance in different ranges. 
```{r echo=FALSE}
R1 <- sum(shotData[shotData$SHOT_ZONE_RANGE == "8- ft.","SHOT_MADE_FLAG"])/sum(shotData[shotData$SHOT_ZONE_RANGE == "8- ft.","SHOT_ATTEMPTED_FLAG"])
R2 <- sum(shotData[shotData$SHOT_ZONE_RANGE == "8-16 ft.","SHOT_MADE_FLAG"])/sum(shotData[shotData$SHOT_ZONE_RANGE == "8-16 ft.","SHOT_ATTEMPTED_FLAG"])
R3 <- sum(shotData[shotData$SHOT_ZONE_RANGE == "16-24 ft.","SHOT_MADE_FLAG"])/sum(shotData[shotData$SHOT_ZONE_RANGE == "16-24 ft.","SHOT_ATTEMPTED_FLAG"])
R4 <- sum(shotData[shotData$SHOT_ZONE_RANGE == "24+ ft.","SHOT_MADE_FLAG"])/sum(shotData[shotData$SHOT_ZONE_RANGE == "24+ ft.","SHOT_ATTEMPTED_FLAG"])
dt3 <- data.frame(table(shotData$SHOT_ZONE_RANGE))
dt3 <- cbind(dt3[c(3,4,1,2),],c(percent(R1),percent(R2),percent(R3),percent(R4)))
names(dt3) <- c("Range", "Attmpt", "FG%")
rownames(dt3) <- NULL
dt3$Range <- factor(dt3$Range, levels=c('8- ft.','8-16 ft.','16-24 ft.','24+ ft.'))
ggplot(data = dt3) + 
  geom_bar(aes(Range, Attmpt), stat = 'identity', width = 0.5, fill = 'light blue')
datatable(dt3)
```

The plot in tis part shows that the 24+ ft. and 8- ft. are his favorite shooting aera. Almost of the attempts lie in these two ranges. With the table, again, it shows how effective and efficient he is at shooting in all kinds of ranges.

# End
R and other data analytics skills are trained during this project and more detailed analysis and interactive visulization can be seen with shiny app "*DU_JIANWEI_FINAL_Shiny.R*". In the end, I wanna say Thank You to Josh for his patience and good lectures in this semester.
